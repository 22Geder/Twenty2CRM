/**
 * 🗺️ מאגר יישובים מלא של ישראל
 * כולל כל הערים, המועצות האזוריות, היישובים הקטנים והשכונות
 * מאורגן לפי אזורים גיאוגרפיים לסינון מדויק
 */

// ========== צפון ישראל ==========
export const NORTH_ISRAEL = {
  // גליל עליון
  galilUpper: [
    'קריית שמונה', 'מטולה', 'כפר גלעדי', 'דפנה', 'שדה נחמיה', 'האון',
    'מעיין ברוך', 'דן', 'סניר', 'בית הלל', 'יסוד המעלה', 'ראש פינה',
    'חצור הגלילית', 'עמיעד', 'איילת השחר', 'נאות מרדכי', 'שאר ישוב',
    'מנרה', 'מרגליות', 'רמות נפתלי', 'יפתח', 'אביבים', 'מלכיה',
    'מעיליא', 'מגד֯ל העמק', 'עין המפרץ'
  ],
  
  // גליל תחתון
  galilLower: [
    'טבריה', 'מגדל', 'כנרת', 'דגניה א', 'דגניה ב', 'כינרת',
    'גינוסר', 'מצפה', 'ארבל', 'כפר חיטים', 'לביא', 'אלומות',
    'בית זרע', 'מעגן', 'עין גב', 'האון', 'רמת מגשימים', 'חד נס',
    'אפיק', 'מבוא חמה', 'רמות', 'גשור'
  ],
  
  // גליל מערבי
  galilWest: [
    'עכו', 'נהריה', 'כרמיאל', 'מעלות תרשיחא', 'שלומי', 'ראש הנקרה',
    'כברי', 'לוחמי הגטאות', 'עברון', 'בן עמי', 'מצובה', 'חניתה',
    'שבי ציון', 'בוסתן הגליל', 'בית העמק', 'כפר מסריק', 'ג׳סר אזרקא', 
    'מזרעה', 'לפידות', 'יערה', 'אדמית', 'אבירים', 'גורן', 'אבן מנחם',
    'יחיעם', 'כליל', 'פקיעין', 'כיסרא סמיע', 'חרפיש', 'ירכא',
    'ג׳ולס', 'אבו סנאן', 'ינוח ג׳ת', 'מעליא', 'כפר יאסיף',
    'תרשיחא', 'מעלות', 'מנות', 'צוריאל', 'עראבה', 'סאג׳ור',
    'דיר אל אסד', 'מג׳ד אל כרום', 'מג׳דל כרום', 'שעב', 'ביר מקסור',
    'נחף', 'כפר סמיע', 'ריינה', 'משהד', 'כפר כנא', 'עילבון',
    'דבוריה', 'נין', 'עין מאהל', 'כפר מנדא', 'טמרה', 'שפרעם',
    'עילוט', 'בית ג׳ן', 'ג׳דיידה מכר', 'ג׳וליס'
  ],
  
  // גולן
  golan: [
    'קצרין', 'בני יהודה', 'חספין', 'מבוא חמה', 'גבעת יואב',
    'נטור', 'אודם', 'עין זיוון', 'מרום גולן', 'אל רום', 'נווה אטיב',
    'קלע', 'אורטל', 'אניעם', 'מג׳דל שמס', 'מסעדה', 'בוקעתא',
    'רמת מגשימים', 'מעלה גמלא', 'יונתן', 'שעל', 'קשת', 'אבני איתן',
    'אפיק', 'גשור', 'נאות גולן', 'אלוני הבשן', 'חד נס'
  ],
  
  // עמק יזרעאל
  jezreel: [
    'עפולה', 'מגדל העמק', 'נצרת', 'נצרת עילית', 'נוף הגליל',
    'יוקנעם', 'יוקנעם עילית', 'קריית טבעון', 'טבעון', 'אלונים',
    'רמת ישי', 'בית שערים', 'כפר יהושע', 'נהלל', 'כפר ברוך',
    'גבת', 'שריד', 'תל עדשים', 'מרחביה', 'גניגר', 'דברת',
    'כפר תבור', 'שדה יעקב', 'מזרע', 'בלפוריה', 'בית לחם הגלילית',
    'הושעיה', 'ציפורי', 'הסוללים', 'אלון הגליל', 'כפר החורש',
    'רמת דוד', 'מנשית זבדה', 'סנדלה', 'דבורייה', 'טמרה',
    'איכסאל', 'כפר קרע', 'עראבה', 'מוקייבלה', 'ג׳לג׳וליה'
  ],
  
  // עמק בית שאן
  beitShean: [
    'בית שאן', 'מעוז חיים', 'נווה אור', 'נווה איתן', 'שדה אליהו',
    'טירת צבי', 'עין הנצי״ב', 'שלוחות', 'רשפים', 'חמדיה',
    'מסילות', 'רוויה', 'שדה נחום', 'כפר רופין', 'גשר',
    'אשדות יעקב', 'מעלה גלבוע', 'גן נר', 'בית השיטה', 'עין חרוד',
    'גבע', 'יפעת', 'גזית'
  ],
  
  // חיפה והקריות
  haifa: [
    'חיפה', 'קריית אתא', 'קריית ביאליק', 'קריית מוצקין', 'קריית ים',
    'קריית חיים', 'נשר', 'טירת כרמל', 'רכסים', 'נשר',
    'עוספיא', 'דאלית אל כרמל', 'דלית אל כרמל', 'כפר חסידים',
    'יגור', 'קריון', 'זכרון יעקב', 'בנימינה גבעת עדה', 'בנימינה',
    'גבעת עדה', 'פרדס חנה כרכור', 'פרדס חנה', 'כרכור',
    'אור עקיבא', 'קיסריה', 'ג׳סר אזרקא', 'פוריידיס', 'עתלית',
    'עין הוד', 'מגדים', 'נווה ים', 'שפיה', 'כפר גליקסון'
  ]
}

// ========== מרכז ישראל ==========
export const CENTER_ISRAEL = {
  // גוש דן
  gushDan: [
    'תל אביב', 'תל אביב יפו', 'יפו', 'רמת גן', 'גבעתיים', 'בני ברק',
    'חולון', 'בת ים', 'אזור', 'קריית אונו', 'אור יהודה', 'יהוד',
    'יהוד מונוסון', 'סביון', 'גני תקווה', 'קריית אריה', 'רמת אפעל'
  ],
  
  // שרון
  sharon: [
    'הרצליה', 'רעננה', 'כפר סבא', 'הוד השרון', 'רמת השרון',
    'נתניה', 'רמת הכובש', 'תל מונד', 'כפר יונה', 'אבן יהודה',
    'קדימה צורן', 'קדימה', 'צורן', 'גאולים', 'גבעת חיים',
    'גבעת חיים איחוד', 'גבעת חיים מאוחד', 'כפר ויתקין', 'בית יצחק',
    'שער אפרים', 'בית ינאי', 'מכמורת', 'אודים', 'נורדיה',
    'גליל ים', 'שפיים', 'גבעת השלושה', 'יקום', 'ארסוף',
    'בית יהושע', 'גן יאשיה', 'בית חרות', 'הדר עם', 'נורית',
    'כפר הס', 'אחיטוב', 'פורת', 'צופים', 'צופית', 'כוכב יאיר',
    'כוכב יאיר צור יגאל', 'צור יגאל', 'תל יצחק', 'בית ברל',
    'טייבה', 'טירה', 'קלנסווה', 'ג׳לג׳וליה', 'כפר קאסם',
    'כפר ברא', 'ראס עלי', 'קציר', 'קציר חריש', 'חריש'
  ],
  
  // פתח תקווה והסביבה
  petahTikva: [
    'פתח תקווה', 'ראש העין', 'שוהם', 'אלעד', 'כפר חב״ד',
    'גבעת שמואל', 'קריית אונו', 'מגשימים', 'משמר השרון',
    'גן חיים', 'צור יצחק', 'עינת', 'יהוד', 'מזכרת בתיה',
    'כפר סירקין', 'גבעת כח'
  ],
  
  // מודיעין והסביבה
  modiin: [
    'מודיעין', 'מודיעין מכבים רעות', 'מכבים', 'רעות', 'שוהם',
    'בן שמן', 'גמזו', 'כפר דניאל', 'ברקת', 'חשמונאים',
    'נוף איילון', 'מבוא מודיעים', 'שילת', 'מתתיהו', 'לפיד'
  ],
  
  // לוד רמלה
  lodRamla: [
    'לוד', 'רמלה', 'ראשון לציון', 'נס ציונה', 'רחובות',
    'באר יעקב', 'ישגב', 'כפר חב״ד', 'נהריה', 'גנות',
    'בית דגן', 'גמזו', 'בני עטרות', 'כפר בילו', 'אחיסמך',
    'נטעים', 'גבעת ברנר', 'גזר', 'חולדה', 'קדרון',
    'כרמי יוסף', 'מזכרת בתיה', 'פתחיה', 'יד רמב״ם',
    'עזריה', 'כפר אביב', 'בן זכאי', 'בניה', 'יבנה'
  ],
  
  // שפלת יהודה
  shfela: [
    'בית שמש', 'צרעה', 'אשתאול', 'תעוז', 'נחם', 'צפרירים',
    'קריית גת', 'נתיב הל״ה', 'הר טוב', 'נווה מיכאל', 'תרום',
    'שורש', 'קריית יערים', 'גבעת יערים', 'בית מאיר', 'שואבה',
    'נטף', 'נחשון', 'גזר', 'גאליה', 'רווחה', 'שדרות',
    'עמקה', 'יסודות', 'כרמיה', 'תלמי יחיאל', 'צלפון',
    'נחשונים', 'בית חשמונאי', 'כפר מנחם', 'גלאון', 'כפר ורבורג',
    'לכיש', 'אמציה', 'נחושה', 'לוזית'
  ]
}

// ========== דרום ישראל ==========
export const SOUTH_ISRAEL = {
  // אשדוד אשקלון
  ashdodAshkelon: [
    'אשדוד', 'אשקלון', 'גן יבנה', 'יבנה', 'גדרה', 'קריית מלאכי',
    'סדרות', 'נתיבות', 'אופקים', 'שדרות', 'קריית גת',
    'קיבוץ יד מרדכי', 'ניר עם', 'ניצנים', 'ברנע', 'אשקלון',
    'זיקים', 'כרמיה', 'מבקיעים', 'אוגד עזה', 'בארותיים',
    'מבטחים', 'שדה דוד', 'מגורות'
  ],
  
  // באר שבע והסביבה
  beerSheva: [
    'באר שבע', 'אופקים', 'נתיבות', 'שדרות', 'קריית גת',
    'דימונה', 'ירוחם', 'מיתר', 'ערד', 'להבים', 'מרחב עם',
    'עומר', 'מיתר', 'חורה', 'לקיה', 'תל שבע', 'כסיפה',
    'ערערה בנגב', 'שגב שלום', 'רהט', 'גבים', 'רביבים',
    'נבטים', 'גילת', 'תקומה', 'גבולות', 'משאבי שדה',
    'בית קמה', 'דביר', 'משען', 'גבעות בר', 'נתיב העשרה',
    'שובל', 'תפרח', 'אשלים', 'רתמים', 'קצרין'
  ],
  
  // נגב מזרחי
  negevEast: [
    'ערד', 'דימונה', 'ירוחם', 'מצפה רמון', 'שדה בוקר',
    'עברונה', 'נאות הכיכר', 'עין תמר', 'עין בוקק',
    'סדום', 'נווה זוהר', 'מרחב עם', 'עין יהב',
    'חצבה', 'יטבתה', 'באר אורה', 'עידן', 'צופר',
    'פארן', 'קטורה', 'גרופית', 'אליפז', 'יהל',
    'לוטן', 'סמר', 'קיבוץ יהל', 'נאות סמדר', 'שיזפון'
  ],
  
  // עוטף עזה
  gazaEnvelope: [
    'שדרות', 'נתיב העשרה', 'ארז', 'כרם שלום', 'כיסופים',
    'עין השלושה', 'ניר עוז', 'נחל עוז', 'כפר עזה',
    'סעד', 'מפלסים', 'מעון', 'נירים', 'מגן',
    'אשכול', 'בארי', 'רעים', 'זיקים', 'יד מרדכי',
    'איבים', 'נתיבות', 'תקומה', 'אופקים', 'תלמי ביל״ו',
    'אוהד', 'זרחיה', 'גבעולים', 'ברור חיל',
    'שוקדה', 'משגב עם', 'תושיה', 'תלמים', 'יכיני'
  ],
  
  // אילת והערבה
  eilat: [
    'אילת', 'יטבתה', 'באר אורה', 'סמר', 'קטורה',
    'גרופית', 'אליפז', 'יהל', 'לוטן', 'נאות סמדר',
    'שיזפון', 'עין יהב', 'פארן', 'צופר', 'עידן',
    'חצבה', 'עברונה', 'נאות הכיכר', 'עין תמר', 'נווה זוהר'
  ]
}

// ========== ירושלים והסביבה ==========
export const JERUSALEM_AREA = {
  jerusalem: [
    'ירושלים', 'מבשרת ציון', 'מעלה אדומים', 'בית שמש', 'גבעת זאב',
    'פסגת זאב', 'נווה יעקב', 'רמות', 'גילה', 'קטמון', 'תלפיות',
    'בית הכרם', 'קריית יובל', 'רמת שרת', 'עיר גנים', 'בית צפאפא',
    'טלביה', 'רחביה', 'נחלאות', 'מאה שערים', 'גאולה',
    'הר נוף', 'בית וגן', 'מלחה', 'עמק רפאים', 'בקעה',
    'ארמון הנציב', 'תלפיות מזרח', 'הר חומה', 'רמות אלון',
    'רמות שלום', 'נווה יעקב', 'פסגת זאב', 'ענתות'
  ],
  
  periphery: [
    'אפרת', 'קריית ארבע', 'ביתר עילית', 'בית אל', 'עפרה',
    'כוכב יעקב', 'אדם', 'מעלה מכמש', 'פסגות', 'דולב',
    'טלמון', 'נחליאל', 'חשמונאים', 'מבוא חורון', 'בית חורון',
    'גבעון החדשה', 'גבעת זאב', 'הר אדר', 'מודיעין עילית',
    'צור הדסה', 'נווה דניאל', 'אלון שבות', 'מגדל עוז',
    'כפר עציון', 'בת עין', 'רוש צורים', 'אלעזר', 'תקוע',
    'מעלות דפנה', 'אנטקות', 'גוש עציון', 'קדומים'
  ]
}

// ========== יהודה ושומרון ==========
export const JUDEA_SAMARIA = {
  judea: [
    'מעלה אדומים', 'קריית ארבע', 'אפרת', 'ביתר עילית',
    'בית אל', 'עפרה', 'כוכב יעקב', 'אדם', 'גבעת זאב',
    'מודיעין עילית', 'אלון שבות', 'נווה דניאל', 'כפר עציון',
    'אלעזר', 'תקוע', 'נוקדים', 'כרמל', 'מעון', 'סוסיה',
    'חברון', 'קריית ארבע', 'בית חגי', 'עתניאל', 'אשכולות',
    'טנא', 'שמעה', 'נגוהות', 'עטרת', 'פסגות'
  ],
  
  samaria: [
    'אריאל', 'קרני שומרון', 'עמנואל', 'קדומים', 'אלקנה',
    'עץ אפרים', 'שערי תקווה', 'יורון', 'ברקן', 'רבבה',
    'מעלה שומרון', 'בית אריה', 'עופרים', 'חלמיש', 'נחליאל',
    'נירית', 'צופים', 'שבי שומרון', 'איתמר', 'יצהר',
    'ברכה', 'אלון מורה', 'חומש', 'שילה', 'עלי',
    'מעלה לבונה', 'אחיה', 'עופר', 'מבוא דותן', 'מתת',
    'גינות', 'אבני חפץ', 'חוות יאיר', 'סלעית', 'ריחן'
  ]
}

// ========== קיצורי ערים =========
export const CITY_ALIASES: Record<string, string> = {
  // תל אביב
  'ת"א': 'תל אביב',
  'תא': 'תל אביב',
  'תל-אביב': 'תל אביב',
  'תל אביב-יפו': 'תל אביב',
  'tlv': 'תל אביב',
  'tel aviv': 'תל אביב',
  
  // ירושלים
  'י-ם': 'ירושלים',
  'י"ם': 'ירושלים',
  'ים': 'ירושלים',
  'jlm': 'ירושלים',
  'jerusalem': 'ירושלים',
  
  // באר שבע
  'ב"ש': 'באר שבע',
  'בש': 'באר שבע',
  'באר-שבע': 'באר שבע',
  'beer sheva': 'באר שבע',
  
  // בני ברק
  'ב"ב': 'בני ברק',
  'בב': 'בני ברק',
  'בני-ברק': 'בני ברק',
  
  // רמת גן
  'ר"ג': 'רמת גן',
  'רג': 'רמת גן',
  'רמת-גן': 'רמת גן',
  
  // פתח תקווה
  'פ"ת': 'פתח תקווה',
  'פת': 'פתח תקווה',
  'פתח-תקווה': 'פתח תקווה',
  
  // כפר סבא
  'כ"ס': 'כפר סבא',
  'כס': 'כפר סבא',
  'כפר-סבא': 'כפר סבא',
  
  // ראשון לציון
  'ר"ל': 'ראשון לציון',
  'רל': 'ראשון לציון',
  'ראשל"צ': 'ראשון לציון',
  'ראשלצ': 'ראשון לציון',
  'ראשון': 'ראשון לציון',
  'ראשון-לציון': 'ראשון לציון',
  
  // קריות
  'ק"א': 'קריית אתא',
  'קא': 'קריית אתא',
  'קריית-אתא': 'קריית אתא',
  'ק"ב': 'קריית ביאליק',
  'קב': 'קריית ביאליק',
  'קריית-ביאליק': 'קריית ביאליק',
  'ק"מ': 'קריית מוצקין',
  'קמ': 'קריית מוצקין',
  'קריית-מוצקין': 'קריית מוצקין',
  'ק"י': 'קריית ים',
  'קי': 'קריית ים',
  'קריית-ים': 'קריית ים',
  'ק"ג': 'קריית גת',
  'קג': 'קריית גת',
  'קריית-גת': 'קריית גת',
  'ק"ש': 'קריית שמונה',
  'קש': 'קריית שמונה',
  'קריית-שמונה': 'קריית שמונה',
  
  // אחרים
  'הוד-השרון': 'הוד השרון',
  'רמת-השרון': 'רמת השרון',
  'נס-ציונה': 'נס ציונה',
  'מעלה-אדומים': 'מעלה אדומים',
  'גבעת-שמואל': 'גבעת שמואל',
  'כפר-קאסם': 'כפר קאסם',
  'נוף-הגליל': 'נוף הגליל',
  'מגדל-העמק': 'מגדל העמק',
  'בית-שמש': 'בית שמש',
  'מודיעין-מכבים-רעות': 'מודיעין',
  'יהוד-מונוסון': 'יהוד',
  'כוכב-יאיר': 'כוכב יאיר',
  'פרדס-חנה-כרכור': 'פרדס חנה',
  'אור-עקיבא': 'אור עקיבא',
  'אור-יהודה': 'אור יהודה',
  'רמת-ישי': 'רמת ישי'
}

// ========== קבוצות ערים קרובות (לפי 30 דקות נסיעה) ==========
export const NEARBY_GROUPS: string[][] = [
  // גוש דן המורחב
  ['תל אביב', 'רמת גן', 'גבעתיים', 'בני ברק', 'חולון', 'בת ים', 
   'רמת השרון', 'הרצליה', 'פתח תקווה', 'יפו', 'אזור', 'קריית אונו',
   'אור יהודה', 'יהוד', 'גבעת שמואל', 'סביון', 'גני תקווה', 'כפר חב״ד'],
  
  // שרון צפוני
  ['נתניה', 'כפר יונה', 'אבן יהודה', 'קדימה', 'צורן', 'תל מונד',
   'פרדס חנה', 'כרכור', 'בנימינה', 'זכרון יעקב', 'עמק חפר'],
  
  // שרון דרומי  
  ['כפר סבא', 'רעננה', 'הוד השרון', 'הרצליה', 'רמת השרון', 
   'כוכב יאיר', 'צור יגאל', 'צופים', 'צופית'],
  
  // פתח תקווה והסביבה
  ['פתח תקווה', 'ראש העין', 'כפר קאסם', 'יהוד', 'אור יהודה', 
   'אלעד', 'שוהם', 'גבעת שמואל', 'קריית אונו'],
  
  // מודיעין והסביבה
  ['מודיעין', 'שוהם', 'לוד', 'רמלה', 'בית שמש', 'חשמונאים',
   'מכבים', 'רעות', 'לפיד', 'בן שמן', 'כפר דניאל'],
  
  // מרכז דרום
  ['ראשון לציון', 'נס ציונה', 'רחובות', 'יבנה', 'גן יבנה',
   'אשדוד', 'גדרה', 'באר יעקב', 'מזכרת בתיה'],
  
  // ירושלים והסביבה
  ['ירושלים', 'בית שמש', 'מעלה אדומים', 'מודיעין', 'מבשרת ציון', 
   'גבעת זאב', 'אפרת', 'ביתר עילית', 'מודיעין עילית'],
  
  // חיפה והקריות
  ['חיפה', 'קריית אתא', 'קריית ביאליק', 'קריית מוצקין', 'קריית ים',
   'נשר', 'טירת כרמל', 'רכסים', 'יגור', 'כפר חסידים',
   'קריון', 'עוספיא', 'דאלית אל כרמל'],
  
  // עכו והסביבה
  ['עכו', 'נהריה', 'שלומי', 'כרמיאל', 'מעלות תרשיחא'],
  
  // עמק יזרעאל
  ['עפולה', 'נצרת', 'נוף הגליל', 'מגדל העמק', 'יוקנעם',
   'נהלל', 'כפר תבור', 'טבריה'],
  
  // באר שבע והסביבה  
  ['באר שבע', 'אופקים', 'נתיבות', 'דימונה', 'ירוחם', 
   'מיתר', 'עומר', 'להבים', 'רהט'],
  
  // אשדוד אשקלון
  ['אשדוד', 'אשקלון', 'קריית גת', 'גן יבנה', 'שדרות', 'יבנה'],
  
  // גליל עליון
  ['קריית שמונה', 'מטולה', 'ראש פינה', 'חצור הגלילית', 'יסוד המעלה'],
  
  // גולן
  ['קצרין', 'בני יהודה', 'חספין', 'מרום גולן', 'גבעת יואב'],
  
  // אילת והערבה
  ['אילת', 'יטבתה', 'באר אורה', 'קטורה', 'לוטן', 'נאות סמדר']
]

// ========== כל היישובים ברשימה אחת (לחיפוש מהיר) ==========
export const ALL_LOCALITIES: string[] = [
  // צפון
  ...NORTH_ISRAEL.galilUpper,
  ...NORTH_ISRAEL.galilLower,
  ...NORTH_ISRAEL.galilWest,
  ...NORTH_ISRAEL.golan,
  ...NORTH_ISRAEL.jezreel,
  ...NORTH_ISRAEL.beitShean,
  ...NORTH_ISRAEL.haifa,
  // מרכז
  ...CENTER_ISRAEL.gushDan,
  ...CENTER_ISRAEL.sharon,
  ...CENTER_ISRAEL.petahTikva,
  ...CENTER_ISRAEL.modiin,
  ...CENTER_ISRAEL.lodRamla,
  ...CENTER_ISRAEL.shfela,
  // דרום
  ...SOUTH_ISRAEL.ashdodAshkelon,
  ...SOUTH_ISRAEL.beerSheva,
  ...SOUTH_ISRAEL.negevEast,
  ...SOUTH_ISRAEL.gazaEnvelope,
  ...SOUTH_ISRAEL.eilat,
  // ירושלים
  ...JERUSALEM_AREA.jerusalem,
  ...JERUSALEM_AREA.periphery,
  // יו"ש
  ...JUDEA_SAMARIA.judea,
  ...JUDEA_SAMARIA.samaria
].filter((v, i, a) => a.indexOf(v) === i) // הסרת כפילויות

// ========== פונקציות עזר ==========

/**
 * נרמול שם יישוב - תמיכה בקיצורים וכתיבים שונים
 */
export function normalizeLocality(name: string): string {
  if (!name) return ''
  
  const normalized = name.trim().toLowerCase()
  
  // בדיקת קיצורים
  for (const [alias, fullName] of Object.entries(CITY_ALIASES)) {
    if (normalized === alias.toLowerCase() || normalized.includes(alias.toLowerCase())) {
      return fullName.toLowerCase()
    }
  }
  
  // הסרת מקפים מיותרים
  return normalized.replace(/-/g, ' ').replace(/\s+/g, ' ').trim()
}

/**
 * חילוץ יישוב מכתובת מלאה
 */
export function extractLocalityFromAddress(address: string): string {
  if (!address) return ''
  
  const normalized = address.toLowerCase()
  
  // חיפוש ישיר ברשימת היישובים
  for (const locality of ALL_LOCALITIES) {
    if (normalized.includes(locality.toLowerCase())) {
      return locality
    }
  }
  
  // נסיון לחלץ מכתובת עם פסיקים
  const parts = address.split(',').map(p => p.trim())
  for (let i = parts.length - 1; i >= 0; i--) {
    const normalizedPart = normalizeLocality(parts[i])
    for (const locality of ALL_LOCALITIES) {
      if (normalizedPart.includes(locality.toLowerCase()) || 
          locality.toLowerCase().includes(normalizedPart)) {
        return locality
      }
    }
  }
  
  return normalizeLocality(address)
}

/**
 * בדיקה האם שני יישובים קרובים (עד 30 דק נסיעה)
 */
export function areLocationsNearby(loc1: string, loc2: string): boolean {
  if (!loc1 || !loc2) return false
  
  const norm1 = normalizeLocality(loc1)
  const norm2 = normalizeLocality(loc2)
  
  // אותו מקום
  if (norm1 === norm2) return true
  if (norm1.includes(norm2) || norm2.includes(norm1)) return true
  
  // בדיקה בקבוצות הקרובות
  for (const group of NEARBY_GROUPS) {
    const groupLower = group.map(c => c.toLowerCase())
    const match1 = groupLower.some(c => norm1.includes(c) || c.includes(norm1))
    const match2 = groupLower.some(c => norm2.includes(c) || c.includes(norm2))
    if (match1 && match2) return true
  }
  
  return false
}

/**
 * קבלת כל היישובים הקרובים ליישוב מסוים
 */
export function getNearbyLocalities(locality: string): string[] {
  if (!locality) return []
  
  const normalized = normalizeLocality(locality)
  const nearby: string[] = [locality]
  
  for (const group of NEARBY_GROUPS) {
    const groupLower = group.map(c => c.toLowerCase())
    if (groupLower.some(c => normalized.includes(c) || c.includes(normalized))) {
      nearby.push(...group)
    }
  }
  
  return [...new Set(nearby)]
}

/**
 * קבלת אזור גיאוגרפי של יישוב
 */
export function getRegion(locality: string): string {
  if (!locality) return 'לא ידוע'
  
  const normalized = normalizeLocality(locality)
  
  // בדיקת צפון
  const northArrays = Object.values(NORTH_ISRAEL)
  for (const arr of northArrays) {
    if (arr.some(c => c.toLowerCase().includes(normalized) || normalized.includes(c.toLowerCase()))) {
      return 'צפון'
    }
  }
  
  // בדיקת מרכז
  const centerArrays = Object.values(CENTER_ISRAEL)
  for (const arr of centerArrays) {
    if (arr.some(c => c.toLowerCase().includes(normalized) || normalized.includes(c.toLowerCase()))) {
      return 'מרכז'
    }
  }
  
  // בדיקת דרום
  const southArrays = Object.values(SOUTH_ISRAEL)
  for (const arr of southArrays) {
    if (arr.some(c => c.toLowerCase().includes(normalized) || normalized.includes(c.toLowerCase()))) {
      return 'דרום'
    }
  }
  
  // בדיקת ירושלים
  const jlmArrays = Object.values(JERUSALEM_AREA)
  for (const arr of jlmArrays) {
    if (arr.some(c => c.toLowerCase().includes(normalized) || normalized.includes(c.toLowerCase()))) {
      return 'ירושלים'
    }
  }
  
  return 'לא ידוע'
}

// סה"כ יישובים במאגר
export const TOTAL_LOCALITIES = ALL_LOCALITIES.length
