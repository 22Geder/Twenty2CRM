const { PrismaClient } = require('@prisma/client')
const prisma = new PrismaClient()

async function main() {
  // 1. ×—×™×¤×•×© ××• ×™×¦×™×¨×ª ×ž×¢×¡×™×§ ××•×¤×¨×™×™×˜
  let employer = await prisma.employer.findFirst({
    where: {
      OR: [
        { name: { contains: '××•×¤×¨×™×™×˜' } },
        { name: { contains: 'operait' } },
        { email: { contains: 'opl.co.il' } }
      ]
    }
  })

  if (!employer) {
    console.log('ðŸ¢ ×™×•×¦×¨ ×ž×¢×¡×™×§ ×—×“×©: ××•×¤×¨×™×™×˜')
    employer = await prisma.employer.create({
      data: {
        name: '××•×¤×¨×™×™×˜ - ×™×“ ×¨××©×•× ×” (Operait)',
        email: 'liatg@opl.co.il',
        phone: '',
        description: '×—×‘×¨×ª ×™×“ ×¨××©×•× ×” - ×ž×›×™×¨×ª ×¨×›×‘×™× ×•×œ×™×¡×™× ×’'
      }
    })
  } else {
    console.log('âœ… × ×ž×¦× ×ž×¢×¡×™×§:', employer.name)
  }

  // 2. ×ž×¦×™××ª ××• ×™×¦×™×¨×ª ×ª×’×™×•×ª ×¨×œ×•×•× ×˜×™×•×ª
  const tagNames = [
    '×ž×›×™×¨×•×ª', '×¨×›×‘', '×œ×™×¡×™× ×’', '×ª×¤×¢×•×œ', '×©×™×¨×•×ª ×œ×§×•×—×•×ª',
    '×’×œ×™×œ×•×ª', '×—×•×œ×•×Ÿ', '×ž×©×¨×” ×ž×œ××”', '×¢×ž×œ×•×ª', '×¨×™×©×™×•×Ÿ × ×”×™×’×”'
  ]

  const tags = {}
  for (const tagName of tagNames) {
    let tag = await prisma.tag.findFirst({ where: { name: tagName } })
    if (!tag) {
      tag = await prisma.tag.create({
        data: { name: tagName, color: getTagColor(tagName) }
      })
      console.log(`ðŸ·ï¸ × ×•×¦×¨×” ×ª×’×™×ª: ${tagName}`)
    }
    tags[tagName] = tag
  }

  // 3. ×™×¦×™×¨×ª ×”×ž×©×¨×•×ª
  const positions = [
    {
      title: '××™×©/××©×ª ×ž×›×™×¨×•×ª - ×™×“ ×¨××©×•× ×” ×’×œ×™×œ×•×ª',
      location: '×’×œ×™×œ×•×ª',
      description: `×œ×ž×—×œ×§×ª ×™×“ ×¨××©×•× ×” ×“×¨×•×©/×” ××™×©/××©×ª ×ž×›×™×¨×•×ª ×œ×¡× ×™×£ ×’×œ×™×œ×•×ª.

×ª×—×•×ž×™ ××—×¨×™×•×ª:
â€¢ ×ž×›×™×¨×ª ×¨×›×‘×™× ×œ×œ×§×•×—×•×ª ×¤×¨×˜×™×™×
â€¢ ×™×™×¢×•×¥ ×•×œ×™×•×•×™ ×œ×§×•×—×•×ª ×‘×ª×”×œ×™×š ×”×¨×›×™×©×”
â€¢ ×¢×ž×™×“×” ×‘×™×¢×“×™ ×ž×›×™×¨×•×ª
â€¢ ×©×™×¨×•×ª ×œ×§×•×—×•×ª ×ž×¦×•×™×Ÿ

×ž×ž×•×¦×¢ ×ž×›×™×¨×•×ª ×œ× ×¦×™×’: 15-18 ×¨×›×‘×™× ×‘×—×•×“×©`,
      requirements: `×“×¨×™×©×•×ª ×”×ª×¤×§×™×“:
â€¢ × ×™×¡×™×•×Ÿ ×‘×ž×›×™×¨×•×ª - ×™×ª×¨×•×Ÿ
â€¢ ×™×›×•×œ×ª ×¢×‘×•×“×” ×‘×¦×•×•×ª
â€¢ ×©×™×¨×•×ª×™×•×ª ×•×™×—×¡×™ ×× ×•×© ×ž×¢×•×œ×™×
â€¢ × ×›×•× ×•×ª ×œ×¢×‘×•×“×” ×‘×™×ž×™ ×©×™×©×™
â€¢ ×¨×™×©×™×•×Ÿ × ×”×™×’×” - ×™×ª×¨×•×Ÿ`,
      salaryRange: '8,000-15,000 â‚ª',
      employmentType: '×ž×©×¨×” ×ž×œ××”',
      keywords: JSON.stringify(['×ž×›×™×¨×•×ª', '×¨×›×‘', '×™×“ ×¨××©×•× ×”', '×’×œ×™×œ×•×ª', '×¢×ž×œ×•×ª', '×©×™×¨×•×ª ×œ×§×•×—×•×ª', '×ž×›×™×¨×ª ×¨×›×‘×™×', '×¡×•×›×Ÿ ×ž×›×™×¨×•×ª']),
      tagIds: ['×ž×›×™×¨×•×ª', '×¨×›×‘', '×’×œ×™×œ×•×ª', '×ž×©×¨×” ×ž×œ××”', '×¢×ž×œ×•×ª', '×©×™×¨×•×ª ×œ×§×•×—×•×ª'],
      aiProfile: JSON.stringify({
        role: '××™×©/××©×ª ×ž×›×™×¨×•×ª ×¨×›×‘×™×',
        industry: '×¨×›×‘ ×•×ª×—×‘×•×¨×”',
        skills: ['×ž×›×™×¨×•×ª', '×©×™×¨×•×ª ×œ×§×•×—×•×ª', '×ž×©× ×•×ž×ª×Ÿ', '×¢×‘×•×“×” ×ª×—×ª ×œ×—×¥', '×™×—×¡×™ ×× ×•×©'],
        experience: '× ×™×¡×™×•×Ÿ ×‘×ž×›×™×¨×•×ª - ×™×ª×¨×•×Ÿ',
        location: '×’×œ×™×œ×•×ª',
        salary: { base: 6050, bonus: '640 â‚ª ×œ×¨×›×‘', average: '8,000-15,000' },
        benefits: ['×¢×ž×œ×•×ª ×ž×”×¨×›×‘ ×”×¨××©×•×Ÿ', '×”×’× ×ª ×©×›×¨ 8,000 â‚ª ×‘-3 ×—×•×“×©×™× ×¨××©×•× ×™×', '×©×¢×•×ª × ×•×¡×¤×•×ª'],
        workDays: '×-×” + ×©×™×©×™',
        keywords: ['×ž×›×™×¨×•×ª', '×¨×›×‘', '×™×“ ×¨××©×•× ×”', '×¢×ž×œ×•×ª', '×¡×•×›×Ÿ ×ž×›×™×¨×•×ª', '×ž×›×™×¨×ª ×¨×›×‘×™×']
      })
    },
    {
      title: '××™×©/××©×ª ×ª×¤×¢×•×œ - ×¡× ×™×£ ×’×œ×™×œ×•×ª',
      location: '×’×œ×™×œ×•×ª',
      description: `×œ×ž×—×œ×§×ª ×™×“ ×¨××©×•× ×” ×“×¨×•×©/×” ××™×©/××©×ª ×ª×¤×¢×•×œ ×œ×¡× ×™×£ ×’×œ×™×œ×•×ª.

×ª×—×•×ž×™ ××—×¨×™×•×ª:
â€¢ ×ª×—×–×•×§×ª ×”××ª×¨ ×•×”×¨×›×‘×™×
â€¢ ×¢×‘×•×“×” ×ž×•×œ ×œ×§×•×—×•×ª
â€¢ ×¡×™×“×•×¨ ×”×ž×’×¨×©
â€¢ ×”×›× ×ª ×¨×›×‘×™× ×œ×¤× ×™ ×‘×“×™×§×”, ×˜×™×¤×•×œ×™× ×•×˜×¡×˜×™×
â€¢ ×¡×™×•×¢ ×‘×ž×›×™×¨×•×ª ×•×ž×¡×™×¨×ª ×¨×›×‘×™×`,
      requirements: `×“×¨×™×©×•×ª ×”×ª×¤×§×™×“:
â€¢ ×¨×™×©×™×•×Ÿ × ×”×™×’×” ×‘×ª×•×§×£ - ×—×•×‘×”!
â€¢ ×™×“×¢ ×•×”×‘× ×” ×˜×›× ×™×ª/×ž×§×¦×•×¢×™×ª ×‘×ª×—×•× ×”×¨×›×‘ - ×™×ª×¨×•×Ÿ
â€¢ ×™×›×•×œ×ª ×¢×‘×•×“×” ×¤×™×–×™×ª
â€¢ ××—×¨×™×•×ª ×•×“×™×™×§× ×•×ª
â€¢ ×©×™×¨×•×ª×™×•×ª`,
      salaryRange: '5,500-7,000 â‚ª',
      employmentType: '×ž×©×¨×” ×ž×œ××”',
      keywords: JSON.stringify(['×ª×¤×¢×•×œ', '×¨×›×‘', '×’×œ×™×œ×•×ª', '×˜×›× ××™', '×¨×™×©×™×•×Ÿ × ×”×™×’×”', '×ª×—×–×•×§×”', '×ž×’×¨×© ×¨×›×‘×™×', '×”×›× ×ª ×¨×›×‘×™×']),
      tagIds: ['×ª×¤×¢×•×œ', '×¨×›×‘', '×’×œ×™×œ×•×ª', '×ž×©×¨×” ×ž×œ××”', '×¨×™×©×™×•×Ÿ × ×”×™×’×”'],
      aiProfile: JSON.stringify({
        role: '××™×©/××©×ª ×ª×¤×¢×•×œ ×ž×’×¨×© ×¨×›×‘×™×',
        industry: '×¨×›×‘ ×•×ª×—×‘×•×¨×”',
        skills: ['×ª×¤×¢×•×œ', '×¢×‘×•×“×” ×¤×™×–×™×ª', '×©×™×¨×•×ª ×œ×§×•×—×•×ª', '×™×“×¢ ×˜×›× ×™ ×‘×¨×›×‘'],
        experience: '×™×“×¢ ×˜×›× ×™ ×‘×¨×›×‘ - ×™×ª×¨×•×Ÿ',
        location: '×’×œ×™×œ×•×ª',
        salary: { base: 5500, experienced: 6000, bonus: '25-45 â‚ª ×œ×¨×›×‘', average: '6,200-7,000' },
        benefits: ['××©"×œ ×ž×”×™×•× ×”×¨××©×•×Ÿ', '×¤×¨×ž×™×•×ª', '×©×¢×•×ª × ×•×¡×¤×•×ª'],
        workDays: '×-×” 08:30-18:00, ×©×™×©×™ 08:30-13:00',
        mustHave: ['×¨×™×©×™×•×Ÿ × ×”×™×’×”'],
        keywords: ['×ª×¤×¢×•×œ', '×¨×›×‘', '×ª×—×–×•×§×”', '×ž×’×¨×©', '×˜×›× ××™ ×¨×›×‘']
      })
    },
    {
      title: '××™×©/××©×ª ×ž×›×™×¨×•×ª ×œ×™×¡×™× ×’ ×¤×¨×˜×™ - ×—×•×œ×•×Ÿ',
      location: '×—×•×œ×•×Ÿ',
      description: `×œ×ž×—×œ×§×ª ×œ×™×¡×™× ×’ ×“×¨×•×©/×” ××™×©/××©×ª ×ž×›×™×¨×•×ª ×œ×¡× ×™×£ ×—×•×œ×•×Ÿ.

×ª×—×•×ž×™ ××—×¨×™×•×ª:
â€¢ ×§×‘×œ×ª ×œ×™×“×™× ×—×ž×™× ×•×‘×™×¦×•×¢ ×©×™×—×•×ª ×˜×œ×¤×•× ×™×•×ª
â€¢ ×¢×¡×§××•×ª ×œ×™×¡×™× ×’ ×¤×¨×˜×™
â€¢ × ×™×”×•×œ ×ž×©× ×•×ž×ª×Ÿ ×¢× ×œ×§×•×—×•×ª ×¤×•×˜× ×¦×™××œ×™×™×
â€¢ ×‘× ×™×™×ª ×¤×ª×¨×•× ×•×ª ×ž×›×™×¨×” ×ž×•×ª××ž×™× ××™×©×™×ª ×œ×œ×§×•×—

×§×œ×™×˜×” ×™×©×™×¨×” ×œ×—×‘×¨×”! ×œ×œ× ×™×ž×™ ×©×™×©×™!`,
      requirements: `×“×¨×™×©×•×ª ×”×ª×¤×§×™×“:
â€¢ × ×™×¡×™×•×Ÿ ×‘×ž×›×™×¨×•×ª ×˜×œ×¤×•× ×™×•×ª - ×™×ª×¨×•×Ÿ
â€¢ ×™×›×•×œ×•×ª ×ž×©× ×•×ž×ª×Ÿ
â€¢ ×©×™×¨×•×ª×™×•×ª ×•×™×—×¡×™ ×× ×•×© ×ž×¢×•×œ×™×
â€¢ ×™×›×•×œ×ª ×¢×ž×™×“×” ×‘×™×¢×“×™×

* ××™×Ÿ ×¢×‘×•×“×” ×ž×”×‘×™×ª`,
      salaryRange: '9,000-12,000 â‚ª',
      employmentType: '×ž×©×¨×” ×ž×œ××”',
      keywords: JSON.stringify(['×ž×›×™×¨×•×ª', '×œ×™×¡×™× ×’', '×—×•×œ×•×Ÿ', '×˜×œ×ž×¨×§×˜×™× ×’', '×œ×™×“×™×', '×ž×›×™×¨×•×ª ×˜×œ×¤×•× ×™×•×ª', '×œ×™×¡×™× ×’ ×¤×¨×˜×™', '×ž×©× ×•×ž×ª×Ÿ']),
      tagIds: ['×ž×›×™×¨×•×ª', '×œ×™×¡×™× ×’', '×—×•×œ×•×Ÿ', '×ž×©×¨×” ×ž×œ××”', '×©×™×¨×•×ª ×œ×§×•×—×•×ª'],
      aiProfile: JSON.stringify({
        role: '× ×¦×™×’/×ª ×ž×›×™×¨×•×ª ×œ×™×¡×™× ×’ ×¤×¨×˜×™',
        industry: '×¨×›×‘ ×•×œ×™×¡×™× ×’',
        skills: ['×ž×›×™×¨×•×ª ×˜×œ×¤×•× ×™×•×ª', '×ž×©× ×•×ž×ª×Ÿ', '×©×™×¨×•×ª ×œ×§×•×—×•×ª', '×¢×ž×™×“×” ×‘×™×¢×“×™×'],
        experience: '× ×™×¡×™×•×Ÿ ×‘×ž×›×™×¨×•×ª - ×™×ª×¨×•×Ÿ',
        location: '×—×•×œ×•×Ÿ',
        salary: { base: 8000, average: '9,000-12,000' },
        benefits: ['×œ×œ× ×™×ž×™ ×©×™×©×™', '×¡×™×‘×•×¡', '×©×¢×•×ª ×’×ž×™×©×•×ª ×œ××ž×”×•×ª'],
        workDays: '×-×” 08:30-17:30',
        workHours: { regular: '08:30-17:30', mothers: '08:00-16:00' },
        noRemote: true,
        keywords: ['×ž×›×™×¨×•×ª', '×œ×™×¡×™× ×’', '×˜×œ×ž×¨×§×˜×™× ×’', '×œ×™×“×™×', '×ž×›×™×¨×•×ª ×˜×œ×¤×•× ×™×•×ª']
      })
    }
  ]

  // ×™×¦×™×¨×ª ×”×ž×©×¨×•×ª
  for (const posData of positions) {
    // ×‘×“×™×§×” ×× ×”×ž×©×¨×” ×›×‘×¨ ×§×™×™×ž×ª
    const existing = await prisma.position.findFirst({
      where: {
        title: posData.title,
        employerId: employer.id
      }
    })

    if (existing) {
      console.log(`âš ï¸ ×ž×©×¨×” ×›×‘×¨ ×§×™×™×ž×ª: ${posData.title}`)
      continue
    }

    const position = await prisma.position.create({
      data: {
        title: posData.title,
        location: posData.location,
        description: posData.description,
        requirements: posData.requirements,
        salaryRange: posData.salaryRange,
        employmentType: posData.employmentType,
        keywords: posData.keywords,
        aiProfile: posData.aiProfile,
        employerId: employer.id,
        active: true,
        tags: {
          connect: posData.tagIds.map(name => ({ id: tags[name].id }))
        }
      }
    })

    console.log(`âœ… × ×•×¦×¨×” ×ž×©×¨×”: ${position.title}`)
  }

  console.log('\nðŸŽ‰ ×”×¡×ª×™×™×!')
}

function getTagColor(name) {
  const colors = {
    '×ž×›×™×¨×•×ª': '#3B82F6',
    '×¨×›×‘': '#10B981',
    '×œ×™×¡×™× ×’': '#8B5CF6',
    '×ª×¤×¢×•×œ': '#F59E0B',
    '×©×™×¨×•×ª ×œ×§×•×—×•×ª': '#EC4899',
    '×’×œ×™×œ×•×ª': '#06B6D4',
    '×—×•×œ×•×Ÿ': '#6366F1',
    '×ž×©×¨×” ×ž×œ××”': '#22C55E',
    '×¢×ž×œ×•×ª': '#EAB308',
    '×¨×™×©×™×•×Ÿ × ×”×™×’×”': '#EF4444'
  }
  return colors[name] || '#64748B'
}

main()
  .catch(e => console.error(e))
  .finally(() => prisma.$disconnect())
