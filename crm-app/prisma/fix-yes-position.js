const { PrismaClient } = require('@prisma/client')
const prisma = new PrismaClient()

async function main() {
  console.log('ðŸ”§ ×ž×ª×§×Ÿ ××ª ×ž×©×¨×ª × ×¦×™×’ ×ž×›×™×¨×•×ª ×˜×œ×¡×œ YES...')

  const positionId = 'dd9acd81-5263-408e-a5d2-5b52990ad425'

  // ×™×¦×™×¨×ª/×¢×“×›×•×Ÿ ×ª×’×™×•×ª
  const tagNames = [
    '×ž×›×™×¨×•×ª',
    '×˜×œ×ž×¨×§×˜×™× ×’',
    '×ž×•×§×“',
    '×¦×¤×•×Ÿ',
    '× ×©×¨',
    'yes',
    '×œ×™×“×™×',
    '×©×™×—×•×ª ×™×•×¦××•×ª',
    '×ž×©×¨×” ×ž×œ××”',
    '×©×™×¨×•×ª ×œ×§×•×—×•×ª'
  ]

  const tagColors = {
    '×ž×›×™×¨×•×ª': '#EF4444',
    '×˜×œ×ž×¨×§×˜×™× ×’': '#F97316',
    '×ž×•×§×“': '#3B82F6',
    '×¦×¤×•×Ÿ': '#10B981',
    '× ×©×¨': '#8B5CF6',
    'yes': '#EC4899',
    '×œ×™×“×™×': '#F59E0B',
    '×©×™×—×•×ª ×™×•×¦××•×ª': '#6366F1',
    '×ž×©×¨×” ×ž×œ××”': '#14B8A6',
    '×©×™×¨×•×ª ×œ×§×•×—×•×ª': '#06B6D4'
  }

  // ×™×¦×™×¨×ª ×ª×’×™×•×ª
  const tags = []
  for (const name of tagNames) {
    let tag = await prisma.tag.findFirst({ where: { name } })
    if (!tag) {
      tag = await prisma.tag.create({
        data: { name, color: tagColors[name] || '#6B7280' }
      })
      console.log(`âœ… ×ª×’×™×ª × ×•×¦×¨×”: ${name}`)
    }
    tags.push(tag)
  }

  // AI Profile ×ž×§×™×£ ×•×ž×¤×•×¨×˜
  const aiProfile = {
    role: '× ×¦×™×’/×ª ×ž×›×™×¨×•×ª ×˜×œ×¡×œ',
    industry: '×˜×œ×§×•×ž×•× ×™×§×¦×™×” ×•×ª×§×©×•×¨×ª',
    location: '× ×©×¨',
    region: '×¦×¤×•×Ÿ',
    experience: '× ×™×¡×™×•×Ÿ ×‘×ž×›×™×¨×•×ª ××• ×©×™×¨×•×ª ×œ×§×•×—×•×ª - ×™×ª×¨×•×Ÿ',
    skills: [
      '×ž×›×™×¨×•×ª ×˜×œ×¤×•× ×™×•×ª',
      '×˜×œ×ž×¨×§×˜×™× ×’',
      '×©×™×¨×•×ª ×œ×§×•×—×•×ª',
      '×¢×‘×•×“×” ×¢× ×œ×™×“×™×',
      '×¡×’×™×¨×ª ×¢×¡×§××•×ª',
      '×¢×‘×•×“×” ×‘×ž×•×§×“',
      '×ª×§×©×•×¨×ª ×‘×™× ××™×©×™×ª',
      '×™×›×•×œ×ª ×©×›× ×•×¢',
      '×¢×ž×™×“×” ×‘×™×¢×“×™×'
    ],
    requirements: [
      '××•×¨×™×™× ×˜×¦×™×” ×ž×›×™×¨×ª×™×ª',
      '×™×›×•×œ×ª ×¢×‘×•×“×” ×‘×¡×‘×™×‘×” ×ž×ž×•×—×©×‘×ª',
      '×›×•×©×¨ ×‘×™×˜×•×™ ×’×‘×•×”',
      '×™×›×•×œ×ª ×©×›× ×•×¢',
      '×¢×‘×•×“×” ×ª×—×ª ×œ×—×¥',
      '×”×™×©×’×™×•×ª ×•×ª×—×¨×•×ª×™×•×ª'
    ],
    keywords: [
      '×ž×›×™×¨×•×ª',
      '×˜×œ×ž×¨×§×˜×™× ×’',
      '×ž×•×§×“ ×ž×›×™×¨×•×ª',
      '×œ×™×“×™× ×—×ž×™×',
      '× ×¦×™×’ ×ž×›×™×¨×•×ª',
      '×˜×œ×¡×œ',
      '× ×©×¨',
      '×¦×¤×•×Ÿ',
      '×©×™×—×•×ª ×™×•×¦××•×ª',
      '×©×™×—×•×ª × ×›× ×¡×•×ª',
      '×¡×’×™×¨×ª ×¢×¡×§××•×ª',
      '×ª×§×©×•×¨×ª',
      'yes',
      '×©×™×¨×•×ª ×œ×§×•×—×•×ª',
      '×ž×›×™×¨×” ×˜×œ×¤×•× ×™×ª',
      '×‘×•× ×•×¡×™×',
      '×¢×ž×™×“×” ×‘×™×¢×“×™×'
    ],
    idealCandidate: '×ž×•×¢×ž×“/×ª ×¢× ××•×¨×™×™× ×˜×¦×™×” ×ž×›×™×¨×ª×™×ª, ×›×•×©×¨ ×‘×™×˜×•×™ ×•×©×›× ×•×¢, × ×™×¡×™×•×Ÿ ×‘×ž×›×™×¨×•×ª ××• ×©×™×¨×•×ª ×œ×§×•×—×•×ª, ×™×›×•×œ×ª ×¢×‘×•×“×” ×‘×¡×‘×™×‘×” ×ž×ž×•×—×©×‘×ª, ×”×™×©×’×™×•×ª ×•×ª×—×¨×•×ª×™×•×ª',
    salary: '×©×›×¨ ×‘×¡×™×¡ 34.30 â‚ª ×œ×©×¢×” + ×‘×•× ×•×¡ ×ž×ž×•×¦×¢ 2,700 â‚ª',
    employmentType: '×ž×©×¨×” ×ž×œ××”',
    workSchedule: '×ž×©×ž×¨×•×ª',
    deepAnalysis: {
      basicInfo: {
        title: '× ×¦×™×’/×ª ×ž×›×™×¨×•×ª ×˜×œ×¡×œ (×œ×™×“×™× ×—×ž×™×)',
        employer: 'YES',
        location: '× ×©×¨',
        region: '×¦×¤×•×Ÿ',
        department: '×ž×›×™×¨×•×ª'
      },
      requirements: {
        mustHave: [
          '××•×¨×™×™× ×˜×¦×™×” ×ž×›×™×¨×ª×™×ª',
          '×™×›×•×œ×ª ×¢×‘×•×“×” ×‘×¡×‘×™×‘×” ×ž×ž×•×—×©×‘×ª',
          '×›×•×©×¨ ×‘×™×˜×•×™ ×•×™×›×•×œ×ª ×©×›× ×•×¢',
          '×¢×‘×•×“×” ×ª×—×ª ×œ×—×¥'
        ],
        niceToHave: [
          '× ×™×¡×™×•×Ÿ ×‘×ž×•×§×“×™ ×©×™×¨×•×ª/×©×™×ž×•×¨/×ž×›×™×¨×”',
          '× ×™×¡×™×•×Ÿ ×‘×ž×›×™×¨×•×ª ×˜×œ×¤×•× ×™×•×ª'
        ],
        experience: {
          minimum: 0,
          preferred: 1,
          description: '× ×™×¡×™×•×Ÿ ×‘×ž×›×™×¨×•×ª ××• ×©×™×¨×•×ª - ×™×ª×¨×•×Ÿ ×ž×©×ž×¢×•×ª×™'
        },
        education: [],
        certifications: []
      },
      skills: {
        technical: ['×¢×‘×•×“×” ×‘×¡×‘×™×‘×” ×ž×ž×•×—×©×‘×ª', 'CRM'],
        professional: ['×ž×›×™×¨×•×ª', '×˜×œ×ž×¨×§×˜×™× ×’', '×¡×’×™×¨×ª ×¢×¡×§××•×ª', '× ×™×”×•×œ ×œ×™×“×™×'],
        soft: ['×›×•×©×¨ ×‘×™×˜×•×™', '×™×›×•×œ×ª ×©×›× ×•×¢', '××¡×¨×˜×™×‘×™×•×ª', '×ª×—×¨×•×ª×™×•×ª', '×”×™×©×’×™×•×ª', '×¡×“×¨ ×•××¨×’×•×Ÿ'],
        languages: ['×¢×‘×¨×™×ª']
      },
      industry: ['×˜×œ×§×•×ž×•× ×™×§×¦×™×”', '×ª×§×©×•×¨×ª', '×ž×›×™×¨×•×ª'],
      seniorityRequired: 'entry',
      keyRequirements: [
        '×ž×›×™×¨×•×ª ×˜×œ×¤×•× ×™×•×ª',
        '×¢×‘×•×“×” ×¢× ×œ×™×“×™×',
        '×¢×ž×™×“×” ×‘×™×¢×“×™×',
        '×ª×—×¨×•×ª×™×•×ª'
      ],
      matchedTags: ['×ž×›×™×¨×•×ª', '×˜×œ×ž×¨×§×˜×™× ×’', '×ž×•×§×“', '×¦×¤×•×Ÿ', '× ×©×¨']
    },
    lastAnalyzed: new Date().toISOString()
  }

  // Keywords ×œ×—×™×¤×•×©
  const keywords = [
    '×ž×›×™×¨×•×ª', '×˜×œ×ž×¨×§×˜×™× ×’', '×ž×•×§×“', '× ×¦×™×’ ×ž×›×™×¨×•×ª', '×˜×œ×¡×œ',
    '×œ×™×“×™×', '×©×™×—×•×ª ×™×•×¦××•×ª', '× ×©×¨', '×¦×¤×•×Ÿ', 'yes', 
    '×¡×’×™×¨×ª ×¢×¡×§××•×ª', '×©×™×¨×•×ª ×œ×§×•×—×•×ª', '×ž×›×™×¨×” ×˜×œ×¤×•× ×™×ª',
    '×©×™×—×•×ª × ×›× ×¡×•×ª', '×‘×•× ×•×¡', '×™×¢×“×™×', '×ª×§×©×•×¨×ª'
  ]

  // ×¢×“×›×•×Ÿ ×”×ž×©×¨×”
  const updatedPosition = await prisma.position.update({
    where: { id: positionId },
    data: {
      aiProfile: JSON.stringify(aiProfile),
      keywords: JSON.stringify(keywords),
      tags: {
        set: tags.map(t => ({ id: t.id }))
      }
    },
    include: { tags: true }
  })

  console.log('\nâœ… ×”×ž×©×¨×” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”!')
  console.log('×›×•×ª×¨×ª:', updatedPosition.title)
  console.log('×ª×’×™×•×ª:', updatedPosition.tags.map(t => t.name).join(', '))
  console.log('Keywords:', keywords.length, '×ž×™×œ×•×ª ×ž×¤×ª×—')
  console.log('\nðŸ“ ×¢×›×©×™×• ×”×ž×©×¨×” ×ª×•×¤×™×¢ ×‘×—×™×¤×•×©×™× ×©×œ:')
  console.log('   - ×ž×›×™×¨×•×ª ×‘×¦×¤×•×Ÿ')
  console.log('   - ×˜×œ×ž×¨×§×˜×™× ×’')
  console.log('   - ×ž×•×§×“×™×')
  console.log('   - × ×©×¨')
}

main()
  .catch(console.error)
  .finally(() => prisma.$disconnect())
