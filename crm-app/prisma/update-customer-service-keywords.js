const { PrismaClient } = require('@prisma/client')
const prisma = new PrismaClient()

/**
 * ðŸŽ¯ ×¡×§×¨×™×¤×˜ ×œ×¢×“×›×•×Ÿ ×ž×™×œ×•×ª ×ž×¤×ª×— ×œ×©×™×¨×•×ª ×œ×§×•×—×•×ª
 * ×ž×•×¡×™×£ ××ª ×›×œ ×”×ª×’×™×•×ª ×•×”×ž×™×œ×•×ª ×ž×¤×ª×— ×©×™×© ×‘×ž×©×¨×•×ª ×˜×œ×¨×™× ×’× ×œ×ž×©×¨×•×ª ×©×™×¨×•×ª ×œ×§×•×—×•×ª
 */

// ×ž×™×œ×•×ª ×ž×¤×ª×— ×‘×¡×™×¡×™×•×ª ×œ×©×™×¨×•×ª ×œ×§×•×—×•×ª - ×–×”×•×ª ×œ×˜×œ×¨×™×
const CUSTOMER_SERVICE_KEYWORDS = [
  // ×›×•×ª×¨×•×ª ×¢×‘×•×“×”
  '× ×¦×™×’ ×©×™×¨×•×ª', '× ×¦×™×’×ª ×©×™×¨×•×ª', '× ×¦×™×’ ×ž×•×§×“', '× ×¦×™×’×ª ×ž×•×§×“', 
  '×ž×•×§×“×Ÿ', '×ž×•×§×“× ×™×ª', '×©×™×¨×•×ª ×œ×§×•×—×•×ª', '× ×¦×™×’ ×˜×œ×¤×•× ×™', '× ×¦×™×’×ª ×˜×œ×¤×•× ×™×ª',
  
  // ×›×™×©×•×¨×™× - ×‘×“×™×•×§ ×›×ž×• ×˜×œ×¨×™×!
  '×©×™×¨×•×ª×™×•×ª', '×¡×‘×œ× ×•×ª', '×™×›×•×œ×ª ×”×§×©×‘×”', '×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª',
  '×ª×§×©×•×¨×ª ×‘×™× ××™×©×™×ª', '×”×§×œ×“×” ×ž×”×™×¨×”', '×¢×‘×•×“×” ×ž×•×œ ×ž×—×©×‘',
  '×¢×‘×•×“×” ×ª×—×ª ×œ×—×¥', '×¢×ž×™×“×” ×‘×™×¢×“×™×', '×©×™×ž×•×¨ ×œ×§×•×—×•×ª',
  '×ž×¢×¨×›×ª CRM', '×ž×¢×¨×›×ª ×˜×œ×¤×•× ×™×”', '×ž×©×ž×¨×•×ª',
  
  // ×¡×¤×¦×™×¤×™ ×œ×‘× ×§××•×ª (×›×ž×• ×˜×œ×¨×™×)
  '×‘× ×§××•×ª', '×¤×™× × ×¡×™×', '×§×•×¤×”', '×¢×¡×§××•×ª', '×œ×§×•×—×•×ª ×¤×¨×˜×™×™×', '×œ×§×•×—×•×ª ×¢×¡×§×™×™×',
  '×§×•×¤××™', '×§×•×¤××™×ª', '×˜×œ×¨', '×˜×œ×¨×™×ª',
  
  // ×ž×•×§×“×™× ×˜×œ×¤×•× ×™×™×
  '×ž×•×§×“ ×ž×›×™×¨×•×ª', '×ž×•×§×“ ×ª×ž×™×›×”', '×ž×•×§×“ ×©×™×¨×•×ª', '×§×•×œ ×¡× ×˜×¨', 'Call Center',
  '×˜×œ×ž×¨×§×˜×™× ×’', '×˜×œ×ž×¨×§×˜×¨', '×˜×œ×ž×¨×§×˜×¨×™×ª',
  
  // ×ª×¢×©×™×™×”
  '×ž×›×™×¨×•×ª', '×ž×›×™×¨×•×ª ×˜×œ×¤×•× ×™×•×ª', '×œ×™×“×™×', '×œ×™×“×™× ×—×ž×™×',
  '×¡×’×™×¨×ª ×¢×¡×§××•×ª', '×™×¢×“×™×', '×¢×ž×œ×•×ª', '×‘×•× ×•×¡',
  
  // ×ž×™×œ×™× ×× ×’×œ×™×•×ª × ×¤×•×¦×•×ª
  'customer service', 'call center', 'helpdesk', 'support',
  
  // ×›×™×©×•×¨×™× ×¨×›×™×
  '×™×—×¡×™ ×× ×•×©', '×ª×•×“×¢×ª ×©×™×¨×•×ª', '××ž×™× ×•×ª', '×¡×“×¨ ×•××¨×’×•×Ÿ'
]

// ×ž×™×œ×•×ª ×ž×¤×ª×— ×¡×¤×¦×™×¤×™×•×ª ×œ-YES - ×ž×›×™×¨×•×ª + ×©×™×¨×•×ª
const YES_KEYWORDS = [
  ...CUSTOMER_SERVICE_KEYWORDS,
  // ×¡×¤×¦×™×¤×™ ×œ-YES
  'yes', '×™×¡', '×˜×œ×¡×œ', '×¡×˜×™× ×’', '× ×˜×¤×œ×™×§×¡', '×“×™×¡× ×™',
  '××™× ×˜×¨× ×˜', '×œ×•×•×™×™×Ÿ', '×›×‘×œ×™×', '×˜×œ×•×•×™×–×™×”', '×ª×§×©×•×¨×ª',
  
  // ×ž×›×™×¨×•×ª
  '×ž×›×™×¨×•×ª', '× ×¦×™×’ ×ž×›×™×¨×•×ª', '× ×¦×™×’×ª ×ž×›×™×¨×•×ª', '×ž×•×§×“ ×ž×›×™×¨×•×ª',
  '×©×™×—×•×ª ×™×•×¦××•×ª', '×©×™×—×•×ª × ×›× ×¡×•×ª', '×œ×™×“×™× ×—×ž×™×',
  '×¡×’×™×¨×ª ×¢×¡×§××•×ª', '×‘×•× ×•×¡×™×', '×™×¢×“×™×', '×˜×œ×ž×¨×§×˜×™× ×’',
  '×”×™×©×’×™×•×ª', '×ª×—×¨×•×ª×™×•×ª', '×©×›× ×•×¢', '×›×•×©×¨ ×‘×™×˜×•×™',
  
  // ×ž×™×§×•×
  '× ×©×¨', '×‘××¨ ×©×‘×¢', '×¦×¤×•×Ÿ', '×“×¨×•×'
]

// ×ª×’×™×•×ª ×œ×©×™×¨×•×ª ×œ×§×•×—×•×ª (×–×”×” ×œ×˜×œ×¨×™×)
const CUSTOMER_SERVICE_TAGS = [
  '×©×™×¨×•×ª ×œ×§×•×—×•×ª',
  '×ž×•×§×“',
  '×˜×œ×ž×¨×§×˜×™× ×’',
  '×ž×©×¨×” ×ž×œ××”',
  '×œ×™×“×™×',
  '×¢×ž×œ×•×ª'
]

// ×¦×‘×¢×™ ×ª×’×™×•×ª
const TAG_COLORS = {
  '×©×™×¨×•×ª ×œ×§×•×—×•×ª': '#06B6D4',    // ×¦×™××Ÿ
  '×ž×•×§×“': '#3B82F6',             // ×›×—×•×œ
  '×˜×œ×ž×¨×§×˜×™× ×’': '#F97316',        // ×›×ª×•×
  '×ž×©×¨×” ×ž×œ××”': '#14B8A6',        // ×˜×™×œ
  '×œ×™×“×™×': '#F59E0B',            // ×¦×”×•×‘-×›×ª×•×
  '×¢×ž×œ×•×ª': '#8B5CF6',            // ×¡×’×•×œ
  '×ž×›×™×¨×•×ª': '#EF4444',           // ××“×•×
  'yes': '#EC4899',              // ×•×¨×•×“
  '× ×©×¨': '#8B5CF6',
  '×¦×¤×•×Ÿ': '#10B981'              // ×™×¨×•×§
}

/**
 * ×‘×•× ×” AI Profile ×œ×©×™×¨×•×ª ×œ×§×•×—×•×ª - ×–×”×” ×œ×˜×œ×¨×™×
 */
function buildCustomerServiceAIProfile(position, region = '') {
  return {
    role: position.title,
    industry: '×©×™×¨×•×ª ×œ×§×•×—×•×ª ×•×ž×•×§×“×™×',
    location: position.location,
    region: region,
    experience: '× ×™×¡×™×•×Ÿ ×‘×©×™×¨×•×ª ×œ×§×•×—×•×ª ××• ×ž×›×™×¨×•×ª - ×™×ª×¨×•×Ÿ ×ž×©×ž×¢×•×ª×™, ×ž×ª××™× ×’× ×œ×œ× × ×™×¡×™×•×Ÿ',
    skills: [
      '×©×™×¨×•×ª ×œ×§×•×—×•×ª',
      '×ª×§×©×•×¨×ª ×‘×™× ××™×©×™×ª',
      '×¢×‘×•×“×” ×‘×¡×‘×™×‘×” ×ž×ž×•×—×©×‘×ª',
      '×¡×‘×œ× ×•×ª',
      '×™×›×•×œ×ª ×”×§×©×‘×”',
      '×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª',
      '×ž×•×œ×˜×™-×˜××¡×§×™× ×’',
      '×¢×‘×•×“×” ×ª×—×ª ×œ×—×¥'
    ],
    requirements: [
      '×ª×•×“×¢×ª ×©×™×¨×•×ª ×’×‘×•×”×”',
      '×™×›×•×œ×ª ×¢×‘×•×“×” ×‘×¡×‘×™×‘×” ×ž×ž×•×—×©×‘×ª',
      '×™×—×¡×™ ×× ×•×© ×ž×¢×•×œ×™×',
      '×¡×‘×œ× ×•×ª ×•×”×§×©×‘×”'
    ],
    keywords: CUSTOMER_SERVICE_KEYWORDS,
    idealCandidate: '×ž×•×¢×ž×“/×ª ×¢× ×ª×•×“×¢×ª ×©×™×¨×•×ª ×’×‘×•×”×”, ×¡×‘×œ× ×•×ª ×•×™×›×•×œ×ª ×”×§×©×‘×”, × ×™×¡×™×•×Ÿ ×‘×©×™×¨×•×ª ×œ×§×•×—×•×ª ××• ×ž×›×™×¨×•×ª - ×™×ª×¨×•×Ÿ, ×™×›×•×œ×ª ×¢×‘×•×“×” ×‘×¡×‘×™×‘×” ×ž×ž×•×—×©×‘×ª',
    employmentType: '×ž×©×¨×” ×ž×œ××”',
    workSchedule: '×ž×©×ž×¨×•×ª',
    deepAnalysis: {
      basicInfo: {
        title: position.title,
        employer: position.employer?.name || '',
        location: position.location,
        region: region,
        department: '×©×™×¨×•×ª ×œ×§×•×—×•×ª'
      },
      requirements: {
        mustHave: [
          '×ª×•×“×¢×ª ×©×™×¨×•×ª ×’×‘×•×”×”',
          '×™×›×•×œ×ª ×¢×‘×•×“×” ×ž×•×œ ×ž×—×©×‘'
        ],
        niceToHave: [
          '× ×™×¡×™×•×Ÿ ×‘×©×™×¨×•×ª ×œ×§×•×—×•×ª',
          '× ×™×¡×™×•×Ÿ ×‘×ž×•×§×“'
        ],
        experience: {
          minimum: 0,
          preferred: 1,
          description: '× ×™×¡×™×•×Ÿ ×‘×©×™×¨×•×ª - ×™×ª×¨×•×Ÿ ×ž×©×ž×¢×•×ª×™'
        }
      },
      skills: {
        technical: ['×¢×‘×•×“×” ×‘×¡×‘×™×‘×” ×ž×ž×•×—×©×‘×ª', 'CRM'],
        professional: ['×©×™×¨×•×ª ×œ×§×•×—×•×ª', '×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª', '×ª×§×©×•×¨×ª'],
        soft: ['×¡×‘×œ× ×•×ª', '×™×›×•×œ×ª ×”×§×©×‘×”', '××ž×¤×ª×™×”', '×™×—×¡×™ ×× ×•×©'],
        languages: ['×¢×‘×¨×™×ª']
      },
      industry: ['×©×™×¨×•×ª ×œ×§×•×—×•×ª', '×ž×•×§×“×™×'],
      seniorityRequired: 'entry',
      keyRequirements: [
        '×ª×•×“×¢×ª ×©×™×¨×•×ª',
        '×¢×‘×•×“×” ×ž×•×œ ×ž×—×©×‘',
        '×™×—×¡×™ ×× ×•×©'
      ]
    },
    lastAnalyzed: new Date().toISOString()
  }
}

/**
 * ×‘×•× ×” AI Profile ×œ-YES - ×ž×›×™×¨×•×ª + ×©×™×¨×•×ª
 */
function buildYESAIProfile(position) {
  return {
    role: position.title,
    industry: '×˜×œ×§×•×ž×•× ×™×§×¦×™×” ×•×ª×§×©×•×¨×ª',
    location: position.location,
    region: position.location?.includes('× ×©×¨') ? '×¦×¤×•×Ÿ' : (position.location?.includes('×‘××¨ ×©×‘×¢') ? '×“×¨×•×' : '×ž×¨×›×–'),
    experience: '× ×™×¡×™×•×Ÿ ×‘×ž×›×™×¨×•×ª ××• ×©×™×¨×•×ª ×œ×§×•×—×•×ª - ×™×ª×¨×•×Ÿ ×ž×©×ž×¢×•×ª×™, ×ž×ª××™× ×’× ×œ×œ× × ×™×¡×™×•×Ÿ',
    skills: [
      '×ž×›×™×¨×•×ª ×˜×œ×¤×•× ×™×•×ª',
      '×˜×œ×ž×¨×§×˜×™× ×’',
      '×©×™×¨×•×ª ×œ×§×•×—×•×ª',
      '×¢×‘×•×“×” ×¢× ×œ×™×“×™×',
      '×¡×’×™×¨×ª ×¢×¡×§××•×ª',
      '×¢×‘×•×“×” ×‘×ž×•×§×“',
      '×ª×§×©×•×¨×ª ×‘×™× ××™×©×™×ª',
      '×™×›×•×œ×ª ×©×›× ×•×¢',
      '×¢×ž×™×“×” ×‘×™×¢×“×™×'
    ],
    requirements: [
      '××•×¨×™×™× ×˜×¦×™×” ×ž×›×™×¨×ª×™×ª',
      '×™×›×•×œ×ª ×¢×‘×•×“×” ×‘×¡×‘×™×‘×” ×ž×ž×•×—×©×‘×ª',
      '×›×•×©×¨ ×‘×™×˜×•×™ ×’×‘×•×”',
      '×™×›×•×œ×ª ×©×›× ×•×¢',
      '×¢×‘×•×“×” ×ª×—×ª ×œ×—×¥',
      '×”×™×©×’×™×•×ª ×•×ª×—×¨×•×ª×™×•×ª'
    ],
    keywords: YES_KEYWORDS,
    idealCandidate: '×ž×•×¢×ž×“/×ª ×¢× ××•×¨×™×™× ×˜×¦×™×” ×ž×›×™×¨×ª×™×ª, ×›×•×©×¨ ×‘×™×˜×•×™ ×•×©×›× ×•×¢, × ×™×¡×™×•×Ÿ ×‘×ž×›×™×¨×•×ª ××• ×©×™×¨×•×ª ×œ×§×•×—×•×ª, ×™×›×•×œ×ª ×¢×‘×•×“×” ×‘×¡×‘×™×‘×” ×ž×ž×•×—×©×‘×ª, ×”×™×©×’×™×•×ª ×•×ª×—×¨×•×ª×™×•×ª. ×ž×ª××™× ×’× ×œ×—×¡×¨×™ × ×™×¡×™×•×Ÿ ×¢× ×ž×•×˜×™×‘×¦×™×” ×’×‘×•×”×”!',
    employmentType: '×ž×©×¨×” ×ž×œ××”',
    workSchedule: '×ž×©×ž×¨×•×ª',
    deepAnalysis: {
      basicInfo: {
        title: position.title,
        employer: 'YES',
        location: position.location,
        region: position.location?.includes('× ×©×¨') ? '×¦×¤×•×Ÿ' : '×ž×¨×›×–',
        department: '×ž×›×™×¨×•×ª'
      },
      requirements: {
        mustHave: [
          '××•×¨×™×™× ×˜×¦×™×” ×ž×›×™×¨×ª×™×ª',
          '×™×›×•×œ×ª ×¢×‘×•×“×” ×‘×¡×‘×™×‘×” ×ž×ž×•×—×©×‘×ª',
          '×›×•×©×¨ ×‘×™×˜×•×™ ×•×™×›×•×œ×ª ×©×›× ×•×¢'
        ],
        niceToHave: [
          '× ×™×¡×™×•×Ÿ ×‘×ž×•×§×“×™ ×©×™×¨×•×ª/×©×™×ž×•×¨/×ž×›×™×¨×”',
          '× ×™×¡×™×•×Ÿ ×‘×ž×›×™×¨×•×ª ×˜×œ×¤×•× ×™×•×ª'
        ],
        experience: {
          minimum: 0,
          preferred: 1,
          description: '× ×™×¡×™×•×Ÿ ×‘×ž×›×™×¨×•×ª ××• ×©×™×¨×•×ª - ×™×ª×¨×•×Ÿ ×ž×©×ž×¢×•×ª×™'
        }
      },
      skills: {
        technical: ['×¢×‘×•×“×” ×‘×¡×‘×™×‘×” ×ž×ž×•×—×©×‘×ª', 'CRM'],
        professional: ['×ž×›×™×¨×•×ª', '×˜×œ×ž×¨×§×˜×™× ×’', '×¡×’×™×¨×ª ×¢×¡×§××•×ª', '× ×™×”×•×œ ×œ×™×“×™×', '×©×™×¨×•×ª ×œ×§×•×—×•×ª'],
        soft: ['×›×•×©×¨ ×‘×™×˜×•×™', '×™×›×•×œ×ª ×©×›× ×•×¢', '××¡×¨×˜×™×‘×™×•×ª', '×ª×—×¨×•×ª×™×•×ª', '×”×™×©×’×™×•×ª', '×¡×‘×œ× ×•×ª'],
        languages: ['×¢×‘×¨×™×ª']
      },
      industry: ['×˜×œ×§×•×ž×•× ×™×§×¦×™×”', '×ª×§×©×•×¨×ª', '×ž×›×™×¨×•×ª', '×©×™×¨×•×ª ×œ×§×•×—×•×ª'],
      seniorityRequired: 'entry',
      keyRequirements: [
        '×ž×›×™×¨×•×ª ×˜×œ×¤×•× ×™×•×ª',
        '×¢×‘×•×“×” ×¢× ×œ×™×“×™×',
        '×¢×ž×™×“×” ×‘×™×¢×“×™×',
        '×©×™×¨×•×ª ×œ×§×•×—×•×ª'
      ]
    },
    lastAnalyzed: new Date().toISOString()
  }
}

async function main() {
  console.log('ðŸš€ ×ž×ª×—×™×œ ×¢×“×›×•×Ÿ ×ž×™×œ×•×ª ×ž×¤×ª×— ×œ×©×™×¨×•×ª ×œ×§×•×—×•×ª...\n')

  // 1. ×™×¦×™×¨×ª ×›×œ ×”×ª×’×™×•×ª ×”× ×“×¨×©×•×ª
  console.log('ðŸ“ ×™×•×¦×¨ ×ª×’×™×•×ª...')
  const allTags = [...new Set([...CUSTOMER_SERVICE_TAGS, '×ž×›×™×¨×•×ª', 'yes', '× ×©×¨', '×¦×¤×•×Ÿ', '×‘××¨ ×©×‘×¢', '×“×¨×•×'])]
  
  for (const tagName of allTags) {
    await prisma.tag.upsert({
      where: { name: tagName },
      update: { color: TAG_COLORS[tagName] || '#6B7280' },
      create: { name: tagName, color: TAG_COLORS[tagName] || '#6B7280' }
    })
  }
  console.log(`âœ… ${allTags.length} ×ª×’×™×•×ª ×ž×•×›× ×•×ª\n`)

  // 2. ×¢×“×›×•×Ÿ ×ž×©×¨×•×ª YES
  console.log('ðŸ“Œ ×ž×¢×“×›×Ÿ ×ž×©×¨×•×ª YES...')
  const yesEmployer = await prisma.employer.findFirst({
    where: { name: { contains: 'YES', mode: 'insensitive' } }
  })

  if (yesEmployer) {
    const yesPositions = await prisma.position.findMany({
      where: { employerId: yesEmployer.id, active: true },
      include: { employer: true }
    })

    for (const position of yesPositions) {
      const region = position.location?.includes('× ×©×¨') ? '×¦×¤×•×Ÿ' : 
                     position.location?.includes('×‘××¨ ×©×‘×¢') ? '×“×¨×•×' : '×ž×¨×›×–'
      
      // ×ª×’×™×•×ª ×œ×ž×©×¨×”
      const yesTags = ['×ž×›×™×¨×•×ª', '×©×™×¨×•×ª ×œ×§×•×—×•×ª', '×ž×•×§×“', '×˜×œ×ž×¨×§×˜×™× ×’', '×œ×™×“×™×', '×¢×ž×œ×•×ª', 'yes', '×ž×©×¨×” ×ž×œ××”']
      if (region === '×¦×¤×•×Ÿ') yesTags.push('× ×©×¨', '×¦×¤×•×Ÿ')
      if (region === '×“×¨×•×') yesTags.push('×‘××¨ ×©×‘×¢', '×“×¨×•×')

      await prisma.position.update({
        where: { id: position.id },
        data: {
          keywords: JSON.stringify(YES_KEYWORDS),
          aiProfile: JSON.stringify(buildYESAIProfile(position)),
          tags: {
            set: [],
            connect: yesTags.map(name => ({ name }))
          }
        }
      })
      console.log(`  âœ… ${position.title} - ×¢×•×“×›×Ÿ`)
    }
    console.log(`âœ… ×¢×•×“×›× ×• ${yesPositions.length} ×ž×©×¨×•×ª YES\n`)
  } else {
    console.log('âš ï¸ ×œ× × ×ž×¦× ×ž×¢×¡×™×§ YES\n')
  }

  // 3. ×¢×“×›×•×Ÿ ×ž×©×¨×•×ª ×©×™×¨×•×ª ×œ×§×•×—×•×ª ×›×œ×œ×™×•×ª (×¡×œ×¢ ×œ×•×’×™×¡×˜×™×§×” ×•××—×¨×™×)
  console.log('ðŸ“Œ ×ž×¢×“×›×Ÿ ×ž×©×¨×•×ª ×©×™×¨×•×ª ×œ×§×•×—×•×ª ×›×œ×œ×™×•×ª...')
  const customerServicePositions = await prisma.position.findMany({
    where: {
      active: true,
      OR: [
        { title: { contains: '×©×™×¨×•×ª', mode: 'insensitive' } },
        { title: { contains: '× ×¦×™×’', mode: 'insensitive' } },
        { title: { contains: '×ž×•×§×“', mode: 'insensitive' } },
        { title: { contains: '×œ×§×•×—×•×ª', mode: 'insensitive' } },
        { description: { contains: '×©×™×¨×•×ª ×œ×§×•×—×•×ª', mode: 'insensitive' } }
      ],
      // ×œ× ×›×•×œ×œ ×‘× ×§××™× ×•×˜×œ×¨×™× (×›×‘×¨ ×ž×¢×•×“×›× ×™×)
      NOT: [
        { title: { contains: '×˜×œ×¨', mode: 'insensitive' } },
        { title: { contains: '×‘× ×§××™', mode: 'insensitive' } },
        { employer: { name: { contains: '×ž×–×¨×—×™', mode: 'insensitive' } } }
      ]
    },
    include: { employer: true }
  })

  let updated = 0
  for (const position of customerServicePositions) {
    // ×‘×“×™×§×” ×× ×–×• ×ž×©×¨×ª yes - ×›×‘×¨ ×˜×•×¤×œ
    if (position.employer?.name?.toLowerCase().includes('yes')) continue

    // ×ª×’×™×•×ª ×›×œ×œ×™×•×ª ×œ×©×™×¨×•×ª ×œ×§×•×—×•×ª
    const tags = ['×©×™×¨×•×ª ×œ×§×•×—×•×ª', '×ž×•×§×“', '×ž×©×¨×” ×ž×œ××”']
    if (position.title?.includes('×ž×›×™×¨×•×ª') || position.description?.includes('×ž×›×™×¨×•×ª')) {
      tags.push('×ž×›×™×¨×•×ª', '×¢×ž×œ×•×ª')
    }

    await prisma.position.update({
      where: { id: position.id },
      data: {
        keywords: JSON.stringify(CUSTOMER_SERVICE_KEYWORDS),
        aiProfile: JSON.stringify(buildCustomerServiceAIProfile(position)),
        tags: {
          connect: tags.map(name => ({ name }))
        }
      }
    })
    console.log(`  âœ… ${position.title} (${position.employer?.name}) - ×¢×•×“×›×Ÿ`)
    updated++
  }
  console.log(`âœ… ×¢×•×“×›× ×• ${updated} ×ž×©×¨×•×ª ×©×™×¨×•×ª ×œ×§×•×—×•×ª\n`)

  // 4. ×¡×™×›×•×
  const allPositions = await prisma.position.count({ where: { active: true } })
  console.log('========================================')
  console.log('âœ¨ ×”×¢×“×›×•×Ÿ ×”×•×©×œ×!')
  console.log(`ðŸ“‹ ×¡×”"×› ×ž×©×¨×•×ª ×¤×¢×™×œ×•×ª: ${allPositions}`)
  console.log('========================================')
}

main()
  .catch((e) => {
    console.error('âŒ ×©×’×™××”:', e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
